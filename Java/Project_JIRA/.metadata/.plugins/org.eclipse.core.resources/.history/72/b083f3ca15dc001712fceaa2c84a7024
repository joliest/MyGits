package com.tracker.Template.web;

import javax.servlet.http.*;

import com.tracker.Module;
import com.tracker.DatabaseHelper.AttributeDatabaseManager;
import com.tracker.DatabaseHelper.DatabaseManager;
import com.tracker.DatabaseHelper.TemplateDatabaseManager;
import com.tracker.Template.model.Template;

import javax.servlet.*;
import java.io.*;
import java.util.HashMap;
import java.util.Map;

public class TemplateServlet extends HttpServlet{
	public void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException{
		response.setContentType("text/html");
		PrintWriter out = response.getWriter();
		
		String category = request.getParameter("category");
		String message = "";
		
		if(category.equals("addTemplate")) {
			Template template = new Template(request);
			DatabaseManager databaseManager = new TemplateDatabaseManager(template);
			databaseManager.add();
			
			message += "Successfully added"; 
		} 

		if(category.equals("loadTemplateList")) {
			DatabaseManager managerTask = new TemplateDatabaseManager(request);
			HashMap<Integer, String> templateList = managerTask.listGroups();
			
			for(Map.Entry<Integer, String> entry : templateList.entrySet()) {
				int id = entry.getKey();
				String name = entry.getValue();
				
				// generates <li id="templateListRow" templateId = "id"> name </li>
				message += "<li id=\"templateListRow\" templateId=\"" + id + "\">";
				message += name;
				message +="</li>";
			}
		} else if(category.equals("loadAttributeGroups")) {
			DatabaseManager attributeGroup = new AttributeDatabaseManager(request);
			HashMap<Integer, String> groupList = attributeGroup.listGroups();
			for(Map.Entry<Integer, String> entry : groupList.entrySet()) {
				//<li id="attributeGroupList" attributeGroupId="1"><b>General</b> </li>
				
				int key = entry.getKey();
				String value = entry.getValue();
				
				message += "<ul>";
				message += "<li id=\"attributeGroupList\" attributeGroupId=\"" + key + "\">";
				message += "<b>" + value + "</b>";
				message += "</li>";
				message += "</ul>";
			}			
		} else if(category.equals("getAttributeList")) {
			
		}
		
		
		
		
		out.println(message);
	}
}
